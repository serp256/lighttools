<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"
					   xmlns:s="library://ns.adobe.com/flex/spark"
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   width="500" height="400">
	
	<fx:Script>
		<![CDATA[
			private var folderUrl:String; // путь папки
			private var classes:Array;  // списки классов swf-ок
			private var liArray:Array;  // of LoaderInfo каждой картинки
			private var urls:Array;		// пути картинок
			private var fnames:Array;   // названия картинок
			private var index:uint = 0;
						
			protected function btPath_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				var f:File = new File();
				f.addEventListener(FileListEvent.SELECT_MULTIPLE, onSelect);
				f.browseForOpenMultiple('Выберите файлы', [new FileFilter('SWF-файлы', '*.swf')]);
			}
			
			private function onSelect(event:FileListEvent):void {	
				status = 'загрузка...';
				
				var f:File = event.currentTarget as File;
				f.removeEventListener(FileListEvent.SELECT_MULTIPLE, onSelect);
				
				classes = [];
				liArray = [];
				urls = [];
				fnames = [];
				index = 0;
		
				folderUrl = (event.files[0].parent as File).url;
				tiPath.text = folderUrl; 
			//	changesInstances = new Vector.<String>();
				
				for each (f in event.files) {
					urls.push(f.url);
					fnames.push(f.name);
				}
		
				loadSwf();
			}
			
			private function loadSwf():void {
				var loader:Loader = new Loader();
				loader.contentLoaderInfo.addEventListener(Event.COMPLETE, onLoadComplete);
				loader.load(new URLRequest(urls[index]));
			}
			
			// swf загружена
			private function onLoadComplete(event:Event):void {
				
				trace('onLoadComplete', index, urls[index]);
				
				// сохраняем имена классов swf-ки
				//var swfName:String = (listSwfs.dataProvider as ArrayCollection).getItemAt(index) as String;
				var li:LoaderInfo = event.target as LoaderInfo;
				var fname:String = fnames[index];
				liArray[fname] = li;
				
				var names:Array= getDefinitionNames(li);
				if (names && names.length > 0) {
					classes[fname] = names[0]; 
				}
				
				index++;
				if (index < urls.length) {
					loadSwf();
				} else {
					status = "загрузка завершена";
					btConvert.enabled = true;
				}
			}
			
			protected function btConvert_clickHandler(event:MouseEvent):void
			{
				for (var swfName:String in liArray) { // по файлам
					var li:LoaderInfo = liArray[swfName];
					var cName:String = classes[swfName];
					
				}
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<s:RadioButtonGroup id="rgMode"/>
		<!-- Разместить невизуальные элементы (например, службы или объекты значений) -->
	</fx:Declarations>
	

	<s:VGroup left="20" right="20" top="20" height="80">
		<s:Label text="Выберите тип ресурсов:"/>
		<s:VGroup x="19" y="94">
			<s:RadioButton label="swf" groupName="rgMode" selected="true"/>
			<s:RadioButton label="png" groupName="rgMode"/>
		</s:VGroup>
	</s:VGroup>
	<s:HGroup y="101" left="20" right="20" height="32" verticalAlign="bottom">
			<s:Label text="Выберите папку:"/>
			<s:TextInput id="tiPath" x="43" y="58" width="100%"/>
		
		<s:Button id="btPath" x="602" y="58" width="35" label="..."
				  click="btPath_clickHandler(event)"/>
	</s:HGroup>
	<s:Button id="btConvert" y="165" label="Конвертировать" click="btConvert_clickHandler(event)"
			  enabled="false" horizontalCenter="0"/>
</s:WindowedApplication>
