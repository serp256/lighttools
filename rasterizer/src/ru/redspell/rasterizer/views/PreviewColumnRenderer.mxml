<?xml version="1.0"?>
<s:GridItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"
	xmlns:mx="library://ns.adobe.com/flex/mx">

	<fx:Script><![CDATA[
		import mx.core.FlexGlobals;
		import mx.managers.PopUpManager;

		import ru.redspell.rasterizer.flatten.FlattenMovieClip;
		import ru.redspell.rasterizer.flatten.FlattenSprite;
		import ru.redspell.rasterizer.flatten.IFlatten;
		import ru.redspell.rasterizer.models.Profile;
		import ru.redspell.rasterizer.models.SwfClass;

		import spark.components.WindowedApplication;

		protected function showPreview():void {
			var cls:SwfClass = data as SwfClass;
			var scales:Object = cls.scales;
			var profile:Profile = Facade.profile;
			var previewWin:PreviewWindow = new PreviewWindow();
			var src:DisplayObject = new cls.definition();
			var flatten:IFlatten = src is MovieClip ? new FlattenMovieClip() : new FlattenSprite();

			PopUpManager.addPopUp(previewWin, (FlexGlobals.topLevelApplication as WindowedApplication), true);
			PopUpManager.centerPopUp(previewWin);
			previewWin.preview(flatten.fromDisplayObject(src, scales.hasOwnProperty(profile.label) ? scales[profile.label] : profile.scale));
		}
		]]></fx:Script>

	<s:VGroup verticalAlign="middle" horizontalAlign="center" width="100%" height="100%">
		<s:Label text="preview" buttonMode="true" textDecoration="underline" click="showPreview()"/>
	</s:VGroup>
</s:GridItemRenderer>